---
title: "Lecture 8"
output:
  html_document:
    df_print: paged
editor_options:
  chunk_output_type: inline
---



```{r}

library(tidyverse)

myname <- "cato"

paste("My name is",myname)

```

```{r}

x <- seq(-5, 5, 0.01)
y <- -5*x**2 + x + 3 
df <- tibble(x = x, y = y)

title <- paste0("The maximum y-value of the curve is: \n",max(y))

ggplot(df, aes(x = x, y = y)) + 
  geom_line() + 
  labs(title = title)

```

```{r}
vals <- rnorm(1000)

sprintf('The mean is %.3f and the standard deviation is %.3f', mean(vals), sd(vals))
```


```{r}

library(httr)
library(jsonlite)
library(tidyverse)
library(lubridate)


```


```{r}
r <- GET('https://api.carbonintensity.org.uk/intensity')
names(r)
r
```

```{r}

# Parse the results from JSON 
parsed <- fromJSON(content(r, 'text'))

class(parsed)


```
```{r}
print(names(parsed$data))
print(names(parsed$data$intensity))
```

We can use `unnest()` to flatten this to a single, unnest data frame wiht 5 columns.

```{r}
# Unnest the intensity data 
df <- parsed$data %>% unnest(cols = intensity)
df
```
```{r}
get_carbon_intensity <- function(){
  r <- GET('https://api.carbonintensity.org.uk/intensity')
  parsed <- fromJSON(content(r, 'text'))
  df <- parsed$data %>% unnest(cols = intensity)
  return(df)
}


get_carbon_intensity()

```
```{r}
date1 <- "2020-10-08"
date2 <- "2020-10-09"
co2_intensity_data <- function(date1,date2){
  #url <- sprintf('https://api.carbonintensity.org.uk/intensity/%s/%s',date1,date2)
  url <- paste0('https://api.carbonintensity.org.uk/intensity/',date1,"/",date2)
  r <- GET(url)
  parsed <- fromJSON(content(r, 'text'))
  df <- parsed$data %>% unnest(cols = intensity)
  return(df)
  
}


co2_intensity_data("2021-01-01","2021-01,08")


```

